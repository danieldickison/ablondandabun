<!DOCTYPE html>
<html>
<head>
    <title>Amanda &amp; Daniel</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style type="text/css">
        body {
            font-family: 'comic sans ms', sans-serif;
        }

        #old-school {

        }

        #less-fanciful {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 9999;
        }

        #fancy {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-flow: column nowrap;
            align-items: center;
            justify-content: flex-end;
            background: linear-gradient(0deg, rgba(154,208,226,1) 0%, rgba(10,144,255,1) 100%);
        }
        #cloud-title {
            position: absolute;
            top: -100px;
            left: calc(50% - 500px);
            z-index: -2;
            animation-duration: 3s;
            animation-name: cloud-float-y;
            animation-iteration-count: infinite;
            animation-direction: alternate;
        }
        #cloud-title > img {
            animation-duration: 5s;
            animation-name: cloud-float-x;
            animation-iteration-count: infinite;
            animation-direction: alternate;
        }
        @keyframes cloud-float-y {
            from {
                transform: translateY(-10px);
            }
            to {
                transform: translateY(10px);
            }
        }
        @keyframes cloud-float-x {
            from {
                transform: translateX(-7px);
            }
            to {
                transform: translateX(5px);
            }
        }
        #sea {
            position: absolute;
            top: 25%;
            bottom: 0;
            left: 0;
            right: 0;
            background: 
                repeat url(/img/waves.png),
                linear-gradient(0deg, rgba(2,0,36,1) 0%, rgba(9,9,121,1) 35%, rgba(0,212,255,1) 100%);
            z-index: -1;
        }
        #scene {
            width: 800px;
            height: 600px;
            outline: 1px dashed red;
            position: relative;
            flex-shrink: 0;
        }
        #scene > * {
            position: absolute;
        }
        #scene .character {
            z-index: 1;
            background-size: cover;
            width: 64px;
            height: 64px;
            transition:
                top 50ms linear,
                left 50ms linear,
                transform 200ms ease-in-out;
        }
        #island {
            left: 280px;
            top: 230px;
        }
        #signpost {
            left: 250px;
            top: 0;
        }
        #bridge-sf {
            top: 0;
            left: 0;
        }
        #bridge-cinci {
            top: 0;
            right: 0;
        }
        #bridge-tokyo {
            bottom: 100px;
            left: 30px;
        }
        #bridge-pgh {
            bottom: 100px;
            right: 0;
        }
    </style>
</head>
<body>
    
    <div id="old-school">
        <h1>a blond and a bun</h1>
        <p>
            This is where all the info would go for boring folks.
        </p>
    </div>

    <div id="fancy">
        <button id="less-fanciful"
            onclick="document.getElementById('fancy').style.display = 'none'"
        >
            less fanciful, please
        </button>
        <div id="cloud-title"><img src="/img/cloud-title.png" alt="Amanda and Daniel"></div>
        <div id="sea"></div>
        <div id="scene">
            <img id="island" src="/img/island.png">
            <img id="bridge-sf" src="/img/bridge-sf.png">
            <img id="bridge-cinci" src="/img/bridge-cinci.png">
            <img id="bridge-pgh" src="/img/bridge-pgh.png">
            <img id="bridge-tokyo" src="/img/bridge-tokyo.png">
            <img id="signpost" src="/img/signpost.png" usemap="#signpost-map">

            <map name="signpost-map">
                <area class="js-go-to-info" alt="Event Info" title="Event Info" href="/info.html" coords="144,78 283,3 336,3 311,52 174,129 174,129 " shape="polygon">
                <area class="js-go-to-about" alt="About Us" title="About Us" href="/about.html" coords="3,60 55,53 187,113 164,160 28,104 " shape="polygon">
                <area class="js-go-to-rsvp" alt="RSVP" title="RSVP" href="/rsvp.html" coords="285,203 274,159 168,98 141,148 243,209 " shape="polygon">
                <area class="js-go-to-registry" alt="Registry" title="Registry" href="/registry.html" coords="35,220 60,177 176,136 195,186 79,237 " shape="polygon">
            </map>
        </div>
    </div>

    <script type="text/javascript">
        const id = (id) => document.getElementById(id);
        const cl = (cl) => document.body.querySelectorAll(cl);

        const scene = id('scene');
        const sea = id('sea');

        const randomizeWaves = () => {
            let x = parseInt(sea.style.backgroundPositionX) || 0;
            let y = parseInt(sea.style.backgroundPositionY) || 0;
            x = (x + randomInt(50, 200)) % 256;
            y = (y + randomInt(50, 200)) % 256;
            sea.style.backgroundPositionX = `${x}px, 0`;
            sea.style.backgroundPositionY = `${y}px, 0`;
        };
        setInterval(randomizeWaves, 2000);

        class Character {
            constructor(imgBase) {
                this.imgBase = imgBase;
                this.node = document.createElement('div');
                this.node.classList.add('character');
                this.moveTo(380, 280);
                scene.appendChild(this.node);
                this.sit();
            }

            get x() {
                return parseInt(this.node.style.left) + 32;
            }
            get y() {
                return parseInt(this.node.style.top) + 32;
            }

            moveTo(x, y) {
                this.node.style.left = (x - 32) + 'px';
                this.node.style.top = (y - 32) + 'px';
            }

            moveBy(dx, dy) {
                this.moveTo(this.x + dx, this.y + dy);
            }

            stopAnimations() {
                if (this.sitRandomizeTimeout) {
                    clearTimeout(this.sitRandomizeTimeout);
                }
                if (this.walkInterval) {
                    clearInterval(this.walkInterval);
                }
            }

            sit() {
                this.stopAnimations();
                this.node.style.transform = 'scale(2)';
                const tick = () => {
                    this.node.style.backgroundImage = `url(/img/${this.imgBase}-sit-${randomInt(1, 5)}.png)`;
                    this.sitRandomizeTimeout = setTimeout(tick, randomInt(500, 1500));
                };
                tick();
            }

            walkTo(x, y) {
                this.stopAnimations();
                let dir;
                if (x < this.x) {
                    this.node.style.transform = 'none';
                    dir = 'left';
                } else {
                    this.node.style.transform = 'scale(-1, 1)';
                    dir = 'right';
                }
                const xStep = dir === 'left' ? -10 : 10;
                const steps = Math.floor(Math.abs((x - this.x) / xStep));
                const yStep = (y - this.y) / steps;
                const tick = () => {
                    if (dir === 'left' && this.x <= x ||
                        dir === 'right' && this.x >= x) {
                        this.sit();
                    } else {
                        this.moveBy(xStep, yStep);
                    }
                };
                this.walkInterval = setInterval(tick, 200);
            }
        }

        function randomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min)) + min; //The maximum is exclusive and the minimum is inclusive
        }

        // Characters
        const forest = new Character('forest');

        const AREAS = {
            info: {x: 832, y: 52},
            rsvp: {x: 832, y: 482},
            about: {x: -18, y: 82},
            registry: {x: 12, y: 482},
        };
        Object.keys(AREAS).forEach(area => {
            cl(`.js-go-to-${area}`).forEach(el => {
                el.addEventListener('click', goTo(area))
            });
        });

        function goTo(area) {
            return event => {
                event.preventDefault();
                const endXY = AREAS[area];
                forest.walkTo(endXY.x, endXY.y);
            };
        }


    </script>
</body>
</html>